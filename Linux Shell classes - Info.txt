Pwd: anirudh@123

Find and locate

find . -name "test*"

. - present working directory
-name - name of the file to search

if locate is not working do updatedb

locate filename

9422

/boot - Contains the file used by boot loader (grub.cfg
/root - Root user home directory, not same as /
/dev - System devices (eg disk, cdrom, speakers)
/etc - COnfiguration Files
/bin -> /user/bin  Everyday user commands
/sbin -> /user/sbin  - Syetm/Filesyetem Commands
/opt Optional add on applications (Not aprt of OS apps)
/proc Running processes (Only exist in Memory)
/lib -> /usr/lib  C programming library files needed by commands and apps
strace -e open pwd

/tmp - Temporary Files
/home - DIrectory for users
/var System Logs
/run System daemons that start very early *eg systemd udev) to stoe temporay runtime files like PID files

/mnt To mount external systems liek NFS

/media - For cdrom mounts

Wildcards

* represents 0 or more characters
? represents a single character
[] Represents a range of characters

Commnad to Open Image File in Linux

yum install ImageMagick -y
cd <path>
display <file-name>

Limux File types
- Regular File
d Directory
l link
c Special file or Device file
s socket
p Named pipe
b Block Device



More/Less Command

more will view one page at a time using spacebar

less will view in reverse, use j and k to go down or come up one line at at time

Cut Command

1. cut -c1 <file-name>  Fetches 1st characer from each line
2. cut -c1-3 <file> Range provided
4. cut -c1,3,5,7 <file> List provided
5. cut -d: -f 1 <file> Delimiter with fiels name
5 cut -d -f 1-2 <file> Fiels with Range
6. ls -l | cut -c2-3


Awk Cmmand

awk --version

awk '{print $1}' <file-name>
awk '{print $1,$3}' >filename>
awk '{print $NF}' <file>   - last Field
awk '/DMA/ {print}' <file>  - Search for a particular field
awk -F":" '{print $1'} >file-name>
cat <file> | awk {$2="Test";print $0}'  - Replace all 2nd fiels with word Test and prints
ls -l | awk '{if ($9 == "passwd") print}'  - Find those field where $9 == passwd
ls -l | awk '{print NF}'  - Number of fields

Gre[/Egrep

grep --version    - Versin Number
grep keyword file
grep -c keytword file  - Gives count of how many times word appears
grep -i Keyword FIle - Case Insensitive search
grep -n keyword - show match wih line numbers
grep -v keyword file - egt everything exceept the one given
egrep -i "Anirudh|Rakesh" <file>  - Searches more than one with a pipe


Sort

sort --version
sort -r file - Reverse Order
sort -k2 file - Starts from wnd file
uniq filename- Dooesnt remove duplicates, use it with sort 
sort <file> | uniq -c
sort <file> | uniq -d - Show only repeated lines

wc

wc - new line count, word count, byte count

wc -l - Lines
wc -w - Word
Wc -b - Byte count


tar 

tar cvf <file>.tar <files>
gzip <file>.tar  - Compress
gzip -d <file>.tar,gz -- Uncompress



truncate

if file is shorter it will append with characters, if larger will cut it


truncate -s 50 file 


Split  - Split on every 100 lines

split -l 100 <file> <new file>


Linux vs Windows Command
Listing dir ls -l
Rename ren mv
Copy copy cp
Move move mv
Clear Screen cls clear
Delete a file del rm 
Compare cotents fc diff
Search for a word find grep
Command help command /? man
Display current location chdir pwd
Display tiem time date


Vi editor

Esc - Command Mode
i - insert mode
save a file and press :wq! or SHift + ZZ

All in command mode
x - Cut on character
u - Undo operation
r- This will prepare to replace a character and then enter the charcter you want to replace with
o - Puts a new line below the line your cursor is and puts the prompt in Insert Mode
a - gives a new space from the cursor to write to next and puts prompt in insert mode
dd- Delete a line
To search put / and type the word
:q! - Exit

Shift + G - Go to end of the file


Sed command

Repalces a string with a new string.

sed 's/name/Name1/g' <file>   - Subsititutes but not replace in the file
use -i to insert in the file

Find and delete a line

sed '/Name/d' file

Remove Empty Lines

sed '/^$/d' new1


Remove the first line in a file

sed '1d' <filename> - Delete 1st
sed '1,2d' <filename> - Delete 1st n 2nd line
sed '$d' <file> - Delete the lsat line


To Replace Tabs
 sed 's/\t//g' <file>
 
 
 Show Defined lines
 
 sed -n 2,4p <file>  - Shows lines 2 to 4
 sed 2,4d <file>  - Shows alll except 2-4
 
 
 Put space after each line
 sed G <file>
 
 
 Substitute alll except a particular line
 sed '8!s/Name/name1/' <file>
 
 Replace in Vi
 :%s/Name/name1
 
 
 
 User Account Management
 
 Commands
 useradd
 groupadd
 userdel
 groupdel
 usermod
 
 Files
 /etc/passwd
 /etc/group
 /etc/shadow
 
 Example
 useradd -g superheros -s /bin/bash -c "user description" -m -d /home/spiderman spiderman.
 
 
 With root
 useradd spiderman
 groupadd superman
 
 userdel spiderman  - Doesnt delete home directory
 userdel -r spiderman - Delete home directory also
 
 
 groupdel <groupname>
 
 Add user to group
 useradd -G <group name> <user name>
 
 
 Modify the visudo file to add user to group or user to wheel to conduct sudo opertion
 
 
 Momitor users
 
 1. who - shows users logged in from all terminals
 2. last - all users logged in from inception time
 3. w  - just like who
 
 
 Talking to Users
 
1.  users - See all users logged in
 wall - To send message to all users
 
 
 
 Type message and press Ctl + D
 
 

 3. Write - Send message to one user
 
 write <user>
 
 
Difference Between Protocols

1. Active Directory = Microsoft
2. IDM = Identity Manager
3. WinBIND = Used in linux to COmmunicate with Windows (Samba)
4. OpenLDAP Open Source
5. IBM DIrectory Server
6. LDAP = Light Weight Directory Access Protocl - Used when any of the directory services like above are installed and it is not a directory services

Syetem Utility Commands

date 
uptime
hostname
uname
which <command name>
cal 
bc

Process and Jobs

Application = Service

Script Written in a file to execute

Process A process is an isntance of an application

Daemon Runs until Uninterrupted

Threads Every process could have multiple threads associated with it

Job - Run a service or process as a work order

Process/Service Commands
systemctl  - To start/stop an application, also used at boot time. ntp is replaced with chronyd in RHEL 7

syetemctl enable ntpd  - This will enable start at boot time and create a symlink

syetemctl enable ntpd



ps Check the process
top Gives top users utilizing the system
kill Kill a process
crontab Scehedule process
at
 
 
 Using Crontab
 
 Open crotab -e
 50 13 * 10 * echo "datta " > crontab_file
 
 50 - Minutes 
 13 - Hour
 * -  day of month
 10 - Month
 * - Day of week
 
 
 4 types of cron jobs
 
 Hourly
 
 Daily 
 Weekly
 
 Monthly
 
 All crons are in /etc/cron._   (type)
 The timing of each are in 
 
 /etc/anacrontab
 
 For Hourly
 /etc/cron.d/hourly
 
 
 Process Management
 Backgrounnd = Ctrl - z , jobs and bg
 Foreground - fg
 Run process even after exit - nohup process &
 OR nohup process > /dev/null 2>&1 &
 
 Kill a process by name = pkill
 
 Process priority = nice edg nice -n 5 process
 
 The niceness scale goes from -20 to 19, the lower the number the more the priority
 
 PRocess Monitoring = top
 
 List process = ps
 
 ---
 
 sleep 10  - Runs till returns the terminals
 Press Ctrl + Z
 
 do 
 jobs 
 
 shows the killed command
 
 Run bg
 puts the killed command bck to action in background
 
 run fg
 
 Brings the background process back to front
 
 ----
 
 System Monitoring
 
 top  - Shows all process
 df - Shows disk utilization
 dmesg - Gives the output of system warnign, errors
 iostat 1  - Gives all input and output stats

 netstat  - netstat -rnv
 free
 cat /proc/cpuinfo
 cat /proc/meminfo
 
 
 Log Monitoring
 
 /var/log
 bootchronyd-NTP
 cron
 maillog
 secure
 messages
 httpd
 
 
 System Maintenance Commands
 
 shutdown
 init 0-6
 reboot
 halt
 
 
 Changing System Hostname
 
 hostnamectl - set-hostname newhostname
 
 Version 7 = Edit /etc/hostname
 
 Version 6 = Edit /etc/sysconfig/network
 
 init 6  - reboot
 
Changing name on prompt requires reboot


Finding System Information

cat /etc/redhat-release
uname -a
dmidecode


System Architecture

32 bit vs 64 Bit

arch


Terminal Control keys

Ctrl + u - Clears everything on the line
Ctrl - c - Stop/Kill a Command
Ctrl + X - Suspend a command

Ctrl + D - Exit an interactive program

Terminal Commands


clear - Clear screen

exit - Exit command

script
Script command stores terminal activities on a log file

script <filename> - Logs the activity for that terminal for the user


Recover Root Password


reboot

Press e

rw init = /sysroot/bin/shadowctrl x
chroot /sysroot
passwd root
touch ./autorelabel
exit
reboot


 
 su password
 
 testing@123


SOS Report - To provide report for red hat case


sosreport

Enviornment Variable 

Envioronment variable is dynamic named value

printenv or env


To set enviornment variables

export var = <value>

To set enviornment variable permanently

vi .bashrc

var=value
export var

source .bashrc
to set global enviornmnent variable
vi /etc/profile or /etc/bashrc



------------

Module 6

Kernel - System which sits in the middle and interact with hardware

Shell - is like a container, interface between users and Kernel/OS
CLI is a shell


Find your shell
echo $0

Available in cat/etc/shells

Your shell - /etc/passwd

Types of Linux shells

Linux Installation with GUI
Desktop GUI enviornments with shells

Gnome 

KDE 

sh - Bourne Shell
bash - Bourne again shell
csh and tcsh shell
ksh - Korne Shell


Shell Scrpting

1. Shell (#!/bin/bash)
2. Comments #
3. Command echo, cp, grep etc
4. Statements (if, while, for etc)


Shell script should have exectuable permission
has to called from absolute path
if called from current location then
./script.bash

Basic Shell Scripts

Variable
a="value"


if-then-scripts

if [ condition ]

then 

logic

else
Logic

fi


For Loop

for x in `cat file.txt | awk '{print $1}'`

do

logic

done


Do while


#!/bin/bash
count=0

while [ $count -lt 10 ]
do
echo $count
sleep 1

count `expr $count +1`
done



Case Statement Scripts

case $choice in

a) date;;
b) ls;;

*) echo "Nothing"

esac


Aliases

On command line

alias l="ls -lrt"
l

alias pl="pwd;ls"
pl

In alias before putting $ sign put \ (baclk slash)


Creating User or GLobal Aliases

User = Applies to one user
Global = Applies to all

For User
Put in .bashrc file

FOr Global put in
/etc/bashrc


Hisory

history commnad

to run same history commands is 
!<command number>

FIle where your history command is stored in

/home/<name>/.bash_history



Module 7

Networking Services and System Updates

Change to Bridge Only Adaptor

and test the ping


Network Components

IP
Subnet mask
Gateway - Which route to send traffic out and where to send it, modem is like gateway
Static vs DHCP (Dynamic Host config prootocl)

Interface (has a MAC address)

MAC address mostly consist of ORagnizontally Unique IDentifier and Network Interface Controler

A subnet mask is a 32 bit number that masks an IP address and divides the ip address into network address and host addressm Subnet mask is made by setting all network bits to all 1 and setting host bits to 0



----


Network Files and Commands

1. Interface Defiantion
2. Assigning an IP address
3. Interface Configuration files

/etc/nswitch.conf
/etc/hosts
/etc/sysconfig/network
/etc/sysconfig/network-scripts/ifcfg-nic
/etc/resolv.conf   - DNS server

Static IP Defined in /etc/sysconfig/network-scripts/ifcfg-nic

Network Commands
ping
ifconfig
ifup  or ifdown
netstat  - netstat -rnv
tcpdump tcpdump -i <interface name>


---
NIC Information
Network Interface Card
NIC can have multiple ports

ethtool <interface>

Other NIC

Lo = Loppback device is a special interface that your computer uses to communicate with itselg. It is used mainly for diagnostics and trouble shottong and to connect to server running on local machine

virb0 = The virb0 or virtual bridge 0 interface is used for NAT. Virutal Environemtn sometime use to connect to outside world

NIC Bonding

NIC Bonding also known as network bonding. It can be defines as aggregation or combination of mul;tiple NIC into single bond interface
Main purpose is to provide high availability and redeundancy


modproobe bonding
modinfo bonding

Create /etc/sysconfig/network-scripts/ifcfg-bond0
Edit
/etc/sysconfig/network-scripts/ethenet1
/etc/sysconfig/network-scripts/ethernet2


bond0 would be like high availability
systemctl restart network



-------------

wget - Download packages from the web

wget <package>


curl

curl http://website.come/filena,each
curl -O http://gogole.com

https://the.earth.li/~sgtatham/putty/latest/putty-0.73.tar.gz

File Transfer

1. FTP
2. Scp
3. rsync



ftp


ftp <machine name>

Enter usernmae
Enter password
At the ftp prompt
ftp> put filemae

Daemon: vsftpd

 sftp localhost
The authenticity of host 'localhost (::1)' can't be established.
ECDSA key fingerprint is SHA256:Wk/7dUCxvjhQ6FI0h1ZDcQFVtAt7oqe1eHbwIReURiY.
ECDSA key fingerprint is MD5:52:8c:b6:c2:20:40:af:f4:82:19:a5:39:85:ba:90:e4.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added 'localhost' (ECDSA) to the list of known hosts.
root@localhost's password:
Connected to localhost.
sftp> put putty-0.73.tar.gz /tmp
Uploading putty-0.73.tar.gz to /tmp/putty-0.73.tar.gz
putty-0.73.tar.gz                             100%  306   336.8KB/s   00:00
sftp> exit


System updates and Repos

yum command isntall a package from repo defined in /etc/yum/repos.d

rpm (Red hat package manager)

Diff b/w yum and rpm

rpm used when you already have a package downloaded 

yum downoads it for you

To install package 

rpm -ihv <location of rpm>

rpm -e <package> - To remove the package


Syetm Upgrade/Patch

Minor upgrade can be done via yum

yum update -y

yum update vs upgrade
upgrade = delete packages and install new one

update=preserve old packages


--------Create local repository via DVD

Create a local diretory 
 will contain all packages

remove contents from yum.repos.d/
in yum.repos.d/
vi localrepo
--Contents

Save file
createrepo localrepo
then test yum install


---Advance Package management

To know more about package
rpm -qi <package name>

To know config files of the package
rpm -qc <package name>


To know if command is part of which package

which <command>
rpm -qf <output from above commnad>



----Roll Back and Updates

Virtual machine  - take Snapshot

Roll back package/patch

yum install <package -name>

yum history undo <id>


Rollback an update

Downgrading a systerm to minor version is not recommeded as might leave the syetm in undersirable or unstable state


yum update - will preserve them
yum upgrade - Upgrade will delete old packages


ssh and telnet

Telnet - Unsecured connection b/w computers
ssh = secured

Two types of package fr most services

Client Package
Server Package

systemctl stop sshd

systemctl start sshd

systemctl status sshd


DNS = Domain name system

Needs bind package

Hostname to IP   (A Record)
IP to hostname  (PTR Record)

Hostname to Hostname (cname record)

Files 

/etc/named.conf

/var/named


Service
systemctl start named

DNS listens on port 53

---
NTP

Purpose

Time Synchronization

File

/etc/ntp.conf

Service 

systemctl restart ntpd

Command 
ntpq > peers

Ntp port 123


---

Chronyd - daemon

Package name = chronyd
Config file - /etc/chrony.conf

Log file - /var/log/chrony

Serverice = systemctl start chronyd

COmmnad:

chronyc

DOnt run ntp and chronyd at the same time


---------
Sendmail

Files
/etc/mail/sendmail.mc
/etc/mail/sendmail.cf
/etc/mail/

Service
systemctl restart sendmail

Command
maill -s "Subject" xyz@domain.com

yum install sendmail
yum install sendmail-cf


---

Web server httpd

files
/etc/http/conf/httpd.conf
/var/www/html/index.html/


systemctl restart httpd
systemctl status httpd

Log file /var/log/httpd

systemctl stop firewalld



---Rsyslog

Purpose generate logs or collect lgs from other servers

Service or package name - rsyslog

/etc/rsyslog.conf

systemctl restart syslog
systemctl enable rsyslog


Linux OS Hardening

1. User Account
2. Remove unwanted packages
3. Stop un used services
4. Check on listening ports
4. Secure ssh config
5. Enable firwall
6. Enable selinux
7. Changing listening services port numbers
8. Keep your os upto date

User Account
Check when password expires

chage -l osboxes

For users
can /etc/login.defs

/etc/pam.d



Remove Unwanted packages

rpm -e <package name>


Stop Un used services

systemctl -a  - Shows all running services

Check on listening ports


netstat -tulnp


Enable firewalld
systemctl start firewalld

Iptables config 

/etc/systemctl.iptables-config

Enable Selinux

Security Enhanced Linux 

Know more about a file
stat <filename>



Open LDAP Instalaltion

Open source implementation of open directory services

Open Ldap Service
slapd

Start or stop service
systemctl start slapd
systemctl enable slapd

Config files
/etc/openldap/sladp.d/



Dependencies Resolved

======================================================================================================================================
 Package                                 Arch                      Version                              Repository               Size
======================================================================================================================================
Installing:
 compat-openldap                         x86_64                    1:2.3.43-5.el7                       base                    174 k
 openldap-clients                        x86_64                    2.4.44-21.el7_6                      base                    190 k
 openldap-devel                          x86_64                    2.4.44-21.el7_6                      base                    804 k
 openldap-servers                        x86_64                    2.4.44-21.el7_6                      base                    2.2 M
 openldap-servers-sql                    x86_64                    2.4.44-21.el7_6                      base                    151 k
Installing for dependencies:
 cyrus-sasl-devel                        x86_64                    2.1.26-23.el7                        base                    310 k
 unixODBC                                x86_64                    2.3.1-14.el7                         base                    413 k

Transaction Summary
======================================================================================================================================
Install  5 Packages (+2 Dependent packages)

Total download size: 4.2 M
Installed size: 12 M
Is this ok [y/d/N]: y
Downloading packages:
(1/7): compat-openldap-2.3.43-5.el7.x86_64.rpm                                                                 | 174 kB  00:00:00
(2/7): cyrus-sasl-devel-2.1.26-23.el7.x86_64.rpm                                                               | 310 kB  00:00:00
(3/7): openldap-clients-2.4.44-21.el7_6.x86_64.rpm                                                             | 190 kB  00:00:00
(4/7): openldap-servers-sql-2.4.44-21.el7_6.x86_64.rpm                                                         | 151 kB  00:00:00
(5/7): unixODBC-2.3.1-14.el7.x86_64.rpm                                                                        | 413 kB  00:00:01
(6/7): openldap-devel-2.4.44-21.el7_6.x86_64.rpm                                                               | 804 kB  00:00:01
(7/7): openldap-servers-2.4.44-21.el7_6.x86_64.rpm                                                             | 2.2 MB  00:00:02
--------------------------------------------------------------------------------------------------------------------------------------
Total                                                                                                 1.0 MB/s | 4.2 MB  00:00:04
Running transaction check
Running transaction test
Transaction test succeeded
Running transaction
  Installing : cyrus-sasl-devel-2.1.26-23.el7.x86_64                                                                              1/7
  Installing : unixODBC-2.3.1-14.el7.x86_64                                                                                       2/7
  Installing : openldap-servers-2.4.44-21.el7_6.x86_64                                                                            3/7
  Installing : openldap-servers-sql-2.4.44-21.el7_6.x86_64                                                                        4/7
  Installing : openldap-devel-2.4.44-21.el7_6.x86_64                                                                              5/7
  Installing : openldap-clients-2.4.44-21.el7_6.x86_64                                                                            6/7
  Installing : 1:compat-openldap-2.3.43-5.el7.x86_64                                                                              7/7
  Verifying  : openldap-servers-2.4.44-21.el7_6.x86_64                                                                            1/7
  Verifying  : openldap-servers-sql-2.4.44-21.el7_6.x86_64                                                                        2/7
  Verifying  : 1:compat-openldap-2.3.43-5.el7.x86_64                                                                              3/7
  Verifying  : unixODBC-2.3.1-14.el7.x86_64                                                                                       4/7
  Verifying  : openldap-devel-2.4.44-21.el7_6.x86_64                                                                              5/7
  Verifying  : cyrus-sasl-devel-2.1.26-23.el7.x86_64                                                                              6/7
  Verifying  : openldap-clients-2.4.44-21.el7_6.x86_64                                                                            7/7

Installed:
  compat-openldap.x86_64 1:2.3.43-5.el7      openldap-clients.x86_64 0:2.4.44-21.el7_6      openldap-devel.x86_64 0:2.4.44-21.el7_6
  openldap-servers.x86_64 0:2.4.44-21.el7_6  openldap-servers-sql.x86_64 0:2.4.44-21.el7_6

Dependency Installed:
  cyrus-sasl-devel.x86_64 0:2.1.26-23.el7                                unixODBC.x86_64 0:2.3.1-14.el7

Complete!


/etc/nsswitch.conf - tracks the user authentication

--------

Tracing Network Route (traceroute)

Command is used to map the journey that a packet of information undertake from source to destination. One use is to locate where data loss occurs through a newtwork 

Each hop in record reflects a new server o router b/w the source  n target reviweing results via traceroute helps

traceroute uses 33434

netstat -rnv - Shows kernel routing table



--------------

Module 8 Disk Management and Run levels

System Run Level

0 Main Run level -  init 0 - Shut down (halt the system)
1  Single user mode , usually aliases as s or S
2
3
4
5
6 Reboot the system

Other run levell
2 - Multi user mode without networking
3  -Multi user mode with networking
5 - Multi user mode with networking and GUI

Please note run level 4 is udndefined or not used/User definable

To check run level

who -r


Linux Boot Process

BIOS Basic I/O System executes MBR, performs system integrity check and check for Boot loader liek CD/DVD
MBR Master boot Record located at first sector of disk have info about GRUB
GRUB GRant unified Boot Loader executes kernal. /boot/grub, can select which order to boot
Kernel Mount boot, Kernel executes /sbin/init program. starts initial 
Init Init executes run level programs
Runlevel Runlevel rpogram are executed from /etc/rc.d/

Newer version of linux
/etc/systemd/system/default.target

To set new default run-level run
systemctl set-default [new target]

Odler version
/etc/inittab

init config files are located in /etc/init.d



Message of the day

Put a message in the file
/etc/motd

------
Cusotnmized message of the day

Create a new file in /etc/profile.d/motd.sh

Add desired command in motd.sh file


Modify the /etc/ssh/sshd_config to edit #PrintMoted yes to PrintMotd no

Restart sshd daemon
systemctl restart sshd.service

Storage

1. Local Storage
2. SAN (Storage Area Network)
3. NAS ( to attach ccomputer through network)


Commands for Disk Partition

df - Tells disk information where it iss partioned to 
fdisk How much disk i

fdisk -ls and how many partition are created with that


Add disk and creating partition


fdisk -l

Disk /dev/sda: 536.9 GB, 536870912000 bytes, 1048576000 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0x000bed01

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1   *        2048     2099199     1048576   83  Linux
/dev/sda2         2099200   528480255   263190528   83  Linux
/dev/sda3       528480256  1031796735   251658240   83  Linux
/dev/sda4      1031796736  1048575999     8389632    5  Extended
/dev/sda5      1031800832  1048575999     8387584   82  Linux swap / Solaris
[root@osboxes osboxes]# clear
[root@osboxes osboxes]# fdisk
Usage:
 fdisk [options] <disk>    change partition table
 fdisk [options] -l <disk> list partition table(s)
 fdisk -s <partition>      give partition size(s) in blocks

Options:
 -b <size>             sector size (512, 1024, 2048 or 4096)
 -c[=<mode>]           compatible mode: 'dos' or 'nondos' (default)
 -h                    print this help text
 -u[=<unit>]           display units: 'cylinders' or 'sectors' (default)
 -v                    print program version
 -C <number>           specify the number of cylinders
 -H <number>           specify the number of heads
 -S <number>           specify the number of sectors per track

[root@osboxes osboxes]# fdisk -l

Disk /dev/sda: 536.9 GB, 536870912000 bytes, 1048576000 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0x000bed01

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1   *        2048     2099199     1048576   83  Linux
/dev/sda2         2099200   528480255   263190528   83  Linux
/dev/sda3       528480256  1031796735   251658240   83  Linux
/dev/sda4      1031796736  1048575999     8389632    5  Extended
/dev/sda5      1031800832  1048575999     8387584   82  Linux swap / Solaris
[root@osboxes osboxes]# fdisk -ls

Disk /dev/sda: 536.9 GB, 536870912000 bytes, 1048576000 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0x000bed01

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1   *        2048     2099199     1048576   83  Linux
/dev/sda2         2099200   528480255   263190528   83  Linux
/dev/sda3       528480256  1031796735   251658240   83  Linux
/dev/sda4      1031796736  1048575999     8389632    5  Extended
/dev/sda5      1031800832  1048575999     8387584   82  Linux swap / Solaris


--After assignng a new disk in Vbox

[root@osboxes osboxes]# fdisk -l

Disk /dev/sda: 536.9 GB, 536870912000 bytes, 1048576000 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0x000bed01

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1   *        2048     2099199     1048576   83  Linux
/dev/sda2         2099200   528480255   263190528   83  Linux
/dev/sda3       528480256  1031796735   251658240   83  Linux
/dev/sda4      1031796736  1048575999     8389632    5  Extended
/dev/sda5      1031800832  1048575999     8387584   82  Linux swap / Solaris

Disk /dev/sdb: 2135 MB, 2135938048 bytes, 4171754 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes

[root@osboxes osboxes]# fdisk /dev/sdb
Welcome to fdisk (util-linux 2.23.2).

Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.

Device does not contain a recognized partition table
Building a new DOS disklabel with disk identifier 0xf8066a97.

Command (m for help): help
h: unknown command
Command action
   a   toggle a bootable flag
   b   edit bsd disklabel
   c   toggle the dos compatibility flag
   d   delete a partition
   g   create a new empty GPT partition table
   G   create an IRIX (SGI) partition table
   l   list known partition types
   m   print this menu
   n   add a new partition
   o   create a new empty DOS partition table
   p   print the partition table
   q   quit without saving changes
   s   create a new empty Sun disklabel
   t   change a partition's system id
   u   change display/entry units
   v   verify the partition table
   w   write table to disk and exit
   x   extra functionality (experts only)

Command (m for help): n
Partition type:
   p   primary (0 primary, 0 extended, 4 free)
   e   extended
Select (default p): p
Partition number (1-4, default 1):
First sector (2048-4171753, default 2048):
Using default value 2048
Last sector, +sectors or +size{K,M,G} (2048-4171753, default 4171753):
Using default value 4171753
Partition 1 of type Linux and of size 2 GiB is set

Command (m for help): w
The partition table has been altered!

Calling ioctl() to re-read partition table.
Syncing disks.


 fdisk -l

Disk /dev/sda: 536.9 GB, 536870912000 bytes, 1048576000 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0x000bed01

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1   *        2048     2099199     1048576   83  Linux
/dev/sda2         2099200   528480255   263190528   83  Linux
/dev/sda3       528480256  1031796735   251658240   83  Linux
/dev/sda4      1031796736  1048575999     8389632    5  Extended
/dev/sda5      1031800832  1048575999     8387584   82  Linux swap / Solaris

Disk /dev/sdb: 2135 MB, 2135938048 bytes, 4171754 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0xf8066a97

   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1            2048     4171753     2084853   83  Linux



Now volume is created we haev to assign a file system type to it

we will create a xfs

mkfs.xfs /dev/sdb1
meta-data=/dev/sdb1              isize=512    agcount=4, agsize=130304 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=0, sparse=0
data     =                       bsize=4096   blocks=521213, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
log      =internal log           bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
[root@osboxes osboxes]#


Now we have to moun to certain mount point


[root@osboxes osboxes]# mkdir /data
[root@osboxes osboxes]# mount /dev/sdb1 /data
[root@osboxes osboxes]# df -h
Filesystem      Size  Used Avail Use% Mounted on
devtmpfs        1.9G     0  1.9G   0% /dev
tmpfs           1.9G     0  1.9G   0% /dev/shm
tmpfs           1.9G  9.5M  1.9G   1% /run
tmpfs           1.9G     0  1.9G   0% /sys/fs/cgroup
/dev/sda3       237G  4.2G  220G   2% /
/dev/sda1       976M  192M  718M  22% /boot
/dev/sda2       247G  161M  235G   1% /home
tmpfs           379M  4.0K  379M   1% /run/user/42
tmpfs           379M   24K  379M   1% /run/user/1000
/dev/sdb1       2.0G   33M  2.0G   2% /data


Persist Entry in /etc/fstab


cat /etc/fstab

#
# /etc/fstab
# Created by anaconda on Mon Feb 11 13:10:45 2019
#
# Accessible filesystems, by reference, are maintained under '/dev/disk'
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info
#
UUID=25e77052-3e2f-47a0-ba1d-4e3b5c698ac7 /                       ext4    defaults        1 1
UUID=ba4b75f6-ea8f-4ac4-a1ee-aae1f3198858 /boot                   ext4    defaults        1 2
UUID=f2a9fd86-def0-4c11-a57f-27d356d8905e /home                   ext4    defaults        1 2
UUID=6b075ea2-0273-4adc-8a80-68d58d55fe27 swap                    swap    defaults        0 0
/dev/sdb1       /data   xfs     defaults        0       0
[root@osboxes osboxes]#

To unmount
umount /data (mount point)

To mount back to /etc/fstab
mount -a



--------------------------------------
Logical Volume Management

Allow disk to be combined together

Disk/s -> Volume Groups  - > Multiple Mount Point


LVM Config During Install




Add Virtual Diska nd create new LVM partition


From Bottom to Top
Hard Disks ( /dev/sda/,/dev/sdb,/dev/sdc)- > Partitions (/dev/sda1,/dev/sda2,/dev/sda3/) -> Physical Volume (/dev/sda1,/dev/sdb1//dev/sdb3) -> Volume Group (datavg) -> Logical Volume(s) (datalv) -> File System (datafs)


We created a hard disk as vitual disk in VMware

Now creating partition 

disk -l

Disk /dev/sda: 536.9 GB, 536870912000 bytes, 1048576000 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0x000bed01

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1   *        2048     2099199     1048576   83  Linux
/dev/sda2         2099200   528480255   263190528   83  Linux
/dev/sda3       528480256  1031796735   251658240   83  Linux
/dev/sda4      1031796736  1048575999     8389632    5  Extended
/dev/sda5      1031800832  1048575999     8387584   82  Linux swap / Solaris

Disk /dev/sdb: 2135 MB, 2135938048 bytes, 4171754 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0xf8066a97

   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1            2048     4171753     2084853   83  Linux

Disk /dev/sdc: 2147 MB, 2147483648 bytes, 4194304 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes

[root@osboxes osboxes]# fdisk /dev/sdc
Welcome to fdisk (util-linux 2.23.2).

Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.

Device does not contain a recognized partition table
Building a new DOS disklabel with disk identifier 0xb0055477.

Command (m for help): p

Disk /dev/sdc: 2147 MB, 2147483648 bytes, 4194304 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0xb0055477

   Device Boot      Start         End      Blocks   Id  System

Command (m for help): n
Partition type:
   p   primary (0 primary, 0 extended, 4 free)
   e   extended
Select (default p): p
Partition number (1-4, default 1): 1
First sector (2048-4194303, default 2048):
Using default value 2048
Last sector, +sectors or +size{K,M,G} (2048-4194303, default 4194303):
Using default value 4194303
Partition 1 of type Linux and of size 2 GiB is set

Command (m for help): p

Disk /dev/sdc: 2147 MB, 2147483648 bytes, 4194304 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0xb0055477

   Device Boot      Start         End      Blocks   Id  System
/dev/sdc1            2048     4194303     2096128   83  Linux

Command (m for help): m
Command action
   a   toggle a bootable flag
   b   edit bsd disklabel
   c   toggle the dos compatibility flag
   d   delete a partition
   g   create a new empty GPT partition table
   G   create an IRIX (SGI) partition table
   l   list known partition types
   m   print this menu
   n   add a new partition
   o   create a new empty DOS partition table
   p   print the partition table
   q   quit without saving changes
   s   create a new empty Sun disklabel
   t   change a partition's system id
   u   change display/entry units
   v   verify the partition table
   w   write table to disk and exit
   x   extra functionality (experts only)

Command (m for help): t
Selected partition 1
Hex code (type L to list all codes): L

 0  Empty           24  NEC DOS         81  Minix / old Lin bf  Solaris
 1  FAT12           27  Hidden NTFS Win 82  Linux swap / So c1  DRDOS/sec (FAT-
 2  XENIX root      39  Plan 9          83  Linux           c4  DRDOS/sec (FAT-
 3  XENIX usr       3c  PartitionMagic  84  OS/2 hidden C:  c6  DRDOS/sec (FAT-
 4  FAT16 <32M      40  Venix 80286     85  Linux extended  c7  Syrinx
 5  Extended        41  PPC PReP Boot   86  NTFS volume set da  Non-FS data
 6  FAT16           42  SFS             87  NTFS volume set db  CP/M / CTOS / .
 7  HPFS/NTFS/exFAT 4d  QNX4.x          88  Linux plaintext de  Dell Utility
 8  AIX             4e  QNX4.x 2nd part 8e  Linux LVM       df  BootIt
 9  AIX bootable    4f  QNX4.x 3rd part 93  Amoeba          e1  DOS access
 a  OS/2 Boot Manag 50  OnTrack DM      94  Amoeba BBT      e3  DOS R/O
 b  W95 FAT32       51  OnTrack DM6 Aux 9f  BSD/OS          e4  SpeedStor
 c  W95 FAT32 (LBA) 52  CP/M            a0  IBM Thinkpad hi eb  BeOS fs
 e  W95 FAT16 (LBA) 53  OnTrack DM6 Aux a5  FreeBSD         ee  GPT
 f  W95 Ext'd (LBA) 54  OnTrackDM6      a6  OpenBSD         ef  EFI (FAT-12/16/
10  OPUS            55  EZ-Drive        a7  NeXTSTEP        f0  Linux/PA-RISC b
11  Hidden FAT12    56  Golden Bow      a8  Darwin UFS      f1  SpeedStor
12  Compaq diagnost 5c  Priam Edisk     a9  NetBSD          f4  SpeedStor
14  Hidden FAT16 <3 61  SpeedStor       ab  Darwin boot     f2  DOS secondary
16  Hidden FAT16    63  GNU HURD or Sys af  HFS / HFS+      fb  VMware VMFS
17  Hidden HPFS/NTF 64  Novell Netware  b7  BSDI fs         fc  VMware VMKCORE
18  AST SmartSleep  65  Novell Netware  b8  BSDI swap       fd  Linux raid auto
1b  Hidden W95 FAT3 70  DiskSecure Mult bb  Boot Wizard hid fe  LANstep
1c  Hidden W95 FAT3 75  PC/IX           be  Solaris boot    ff  BBT
1e  Hidden W95 FAT1 80  Old Minix
Hex code (type L to list all codes): 8e
Changed type of partition 'Linux' to 'Linux LVM'

Command (m for help): p

Disk /dev/sdc: 2147 MB, 2147483648 bytes, 4194304 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0xb0055477

   Device Boot      Start         End      Blocks   Id  System
/dev/sdc1            2048     4194303     2096128   8e  Linux LVM

Command (m for help): w
The partition table has been altered!

Calling ioctl() to re-read partition table.
Syncing disks.
[root@osboxes osboxes]# df -h
Filesystem      Size  Used Avail Use% Mounted on
devtmpfs        1.9G     0  1.9G   0% /dev
tmpfs           1.9G     0  1.9G   0% /dev/shm
tmpfs           1.9G  9.6M  1.9G   1% /run
tmpfs           1.9G     0  1.9G   0% /sys/fs/cgroup
/dev/sda3       237G  4.2G  220G   2% /
/dev/sdb1       2.0G   33M  2.0G   2% /data
/dev/sda1       976M  192M  718M  22% /boot
/dev/sda2       247G  161M  235G   1% /home
tmpfs           379M  4.0K  379M   1% /run/user/42
tmpfs           379M   24K  379M   1% /run/user/1000
[root@osboxes osboxes]# fdisk -l

Disk /dev/sda: 536.9 GB, 536870912000 bytes, 1048576000 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0x000bed01

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1   *        2048     2099199     1048576   83  Linux
/dev/sda2         2099200   528480255   263190528   83  Linux
/dev/sda3       528480256  1031796735   251658240   83  Linux
/dev/sda4      1031796736  1048575999     8389632    5  Extended
/dev/sda5      1031800832  1048575999     8387584   82  Linux swap / Solaris

Disk /dev/sdb: 2135 MB, 2135938048 bytes, 4171754 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0xf8066a97

   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1            2048     4171753     2084853   83  Linux

Disk /dev/sdc: 2147 MB, 2147483648 bytes, 4194304 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0xb0055477

   Device Boot      Start         End      Blocks   Id  System
/dev/sdc1            2048     4194303     2096128   8e  Linux LVM




Now create Physical Volume


[root@osboxes osboxes]# pvcreate /dev/sdc1
  Physical volume "/dev/sdc1" successfully created.
[root@osboxes osboxes]# pvdisplay
  "/dev/sdc1" is a new physical volume of "<2.00 GiB"
  --- NEW Physical volume ---
  PV Name               /dev/sdc1
  VG Name
  PV Size               <2.00 GiB
  Allocatable           NO
  PE Size               0
  Total PE              0
  Free PE               0
  Allocated PE          0
  PV UUID               UFJLAB-wzLR-P9yc-x9TT-SAME-gpsK-XcXIi4

[root@osboxes osboxes]#


Create Volume Group


vgcreate test_vg /dev/sdc1
  Volume group "test_vg" successfully created
[root@osboxes osboxes]# vgdisplay
  --- Volume group ---
  VG Name               test_vg
  System ID
  Format                lvm2
  Metadata Areas        1
  Metadata Sequence No  1
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                0
  Open LV               0
  Max PV                0
  Cur PV                1
  Act PV                1
  VG Size               <2.00 GiB
  PE Size               4.00 MiB
  Total PE              511
  Alloc PE / Size       0 / 0
  Free  PE / Size       511 / <2.00 GiB
  VG UUID               sZdalT-YTGG-7fOt-UHSl-TLED-gqh6-HS2uY1

[root@osboxes osboxes]# vgdisplay test_vg
  --- Volume group ---
  VG Name               test_vg
  System ID
  Format                lvm2
  Metadata Areas        1
  Metadata Sequence No  1
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                0
  Open LV               0
  Max PV                0
  Cur PV                1
  Act PV                1
  VG Size               <2.00 GiB
  PE Size               4.00 MiB
  Total PE              511
  Alloc PE / Size       0 / 0
  Free  PE / Size       511 / <2.00 GiB
  VG UUID               sZdalT-YTGG-7fOt-UHSl-TLED-gqh6-HS2uY1
  
  
  
  Create logical Volume
  
  
  
[root@osboxes osboxes]# lvcreate -n test_lv --size 2020M test_vg
  Logical volume "test_lv" created.
[root@osboxes osboxes]# lvdisplay test_lv
  Volume group "test_lv" not found
  Cannot process volume group test_lv
[root@osboxes osboxes]# lvdisplay
  --- Logical volume ---
  LV Path                /dev/test_vg/test_lv
  LV Name                test_lv
  VG Name                test_vg
  LV UUID                Z3W7Ve-IEla-RDMr-ekeA-EcHd-Uu7r-Z7Axak
  LV Write Access        read/write
  LV Creation host, time osboxes, 2019-10-14 01:15:30 -0400
  LV Status              available
  # open                 0
  LV Size                1.97 GiB
  Current LE             505
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:0

mkfs.xfs /dev/test_vg/test_lv


mount /dev/test_vg/test_lv /test

Persist entry in /etc/fstab, check proper df -h 

[root@osboxes osboxes]# df -h | grep /test
/dev/mapper/test_vg-test_lv  997M   33M  965M   4% /test
[root@osboxes osboxes]# cat /etc/fstab | tail -1
/dev/mapper/test_vg-test_lv     /test   xfs     defaults        0       0
[root@osboxes osboxes]#

-------------

Add and extend disk using LVm


add a new disk from Vmwware box

Partiton the disk

Same method as above
enter fdisk
 
 Type n and put the value
 Choose t for Linux LVM Type
 p to check the partition
 w to write
 
 
 Now create Physical volume - Have to do everytime
 
 vgextend test_vg /dev/sdd1
  Volume group "test_vg" successfully extended
[root@osboxes osboxes]# vgdisplay
  --- Volume group ---
  VG Name               test_vg
  System ID
  Format                lvm2
  Metadata Areas        2
  Metadata Sequence No  3
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                1
  Open LV               1
  Max PV                0
  Cur PV                2
  Act PV                2
  VG Size               8.99 GiB
  PE Size               4.00 MiB
  Total PE              2302
  Alloc PE / Size       250 / 1000.00 MiB
  Free  PE / Size       2052 / <8.02 GiB
  VG UUID               Z5O4Zj-aJgw-4yrk-cbK1-6OaQ-rAa3-QR5k1m

[root@osboxes osboxes]#

Do Logical Volume extend

[root@osboxes osboxes]# lvextend -L+8000M /dev/mapper/test_vg-test_lv
  Size of logical volume test_vg/test_lv changed from 1000.00 MiB (250 extents) to <8.79 GiB (2250 extents).
  Logical volume test_vg/test_lv successfully resized.
[root@osboxes osboxes]#


Now extend file system

[root@osboxes osboxes]# xfs_growfs /dev/mapper/test_vg-test_lv
meta-data=/dev/mapper/test_vg-test_lv isize=512    agcount=4, agsize=64000 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=0 spinodes=0
data     =                       bsize=4096   blocks=256000, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
log      =internal               bsize=4096   blocks=855, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
data blocks changed from 256000 to 2304000
[root@osboxes osboxes]# df -h
Filesystem                   Size  Used Avail Use% Mounted on
devtmpfs                     1.9G     0  1.9G   0% /dev
tmpfs                        1.9G     0  1.9G   0% /dev/shm
tmpfs                        1.9G  9.6M  1.9G   1% /run
tmpfs                        1.9G     0  1.9G   0% /sys/fs/cgroup
/dev/sda3                    237G  4.2G  220G   2% /
/dev/sda1                    976M  192M  718M  22% /boot
/dev/mapper/test_vg-test_lv  8.8G   34M  8.8G   1% /test
/dev/sdb1                    2.0G   33M  2.0G   2% /data
/dev/sda2                    247G  161M  235G   1% /home
tmpfs                        379M  4.0K  379M   1% /run/user/42
tmpfs                        379M   28K  379M   1% /run/user/1000
[root@osboxes osboxes]#


Adding/Extend Swap Space

Swap space in linux is used wgen RAM is full and system needs more memory. Inactive pacges are moved to swap space.

Recommended swap size = twice size of ram

M = RAM in GB and S = AMount of swap in GB then
if M < 2
then S=  M *2
else
S = M +2


Commands
dd
mkswap
swapon or swapoff

Add new swap
[root@osboxes osboxes]# dd if=/dev/zero of=/newSwap bs=1M count=1024
1024+0 records in
1024+0 records out
1073741824 bytes (1.1 GB) copied, 10.4292 s, 103 MB/s

[root@osboxes /]# mkswap /newSwap
Setting up swapspace version 1, size = 1048572 KiB
no label, UUID=1be7e9b9-efe4-44e6-91c2-6f3ff5466864
[root@osboxes /]#



File System Check and xfs_repair (For xfs file system)

fsck utility is for ext2, ext3, ext4


Make sure to execute the fsck on an unmounted file system to avoid any dta corruption issues

Force file system check even if its clean using option -f

Attempt to fix detected problems automatically using option -y

xfs_Repair is highly scalable and is designed to repir even very large file system ,xfs_repair does not runa t boot time

Exit codes for fsck
0 - No errors
1 - File system errors corected

2 - System should be rebooted

4- File syetm errors left uncorrected



 xfs_repair /dev/sdb1
xfs_repair: /dev/sdb1 contains a mounted filesystem
xfs_repair: /dev/sdb1 contains a mounted and writable filesystem

fatal error -- couldn't initialize XFS library
[root@osboxes osboxes]# umount /data
[root@osboxes osboxes]# df -h
Filesystem                   Size  Used Avail Use% Mounted on
devtmpfs                     1.9G     0  1.9G   0% /dev
tmpfs                        1.9G     0  1.9G   0% /dev/shm
tmpfs                        1.9G  9.6M  1.9G   1% /run
tmpfs                        1.9G     0  1.9G   0% /sys/fs/cgroup
/dev/sda3                    237G  5.2G  219G   3% /
/dev/sda1                    976M  192M  718M  22% /boot
/dev/mapper/test_vg-test_lv  8.8G   34M  8.8G   1% /test
/dev/sda2                    247G  161M  235G   1% /home
tmpfs                        379M  4.0K  379M   1% /run/user/42
tmpfs                        379M   28K  379M   1% /run/user/1000
[root@osboxes osboxes]# xfs_repair /dev/sdb1
Phase 1 - find and verify superblock...
Phase 2 - using internal log
        - zero log...
        - scan filesystem freespace and inode maps...
        - found root inode chunk
Phase 3 - for each AG...
        - scan and clear agi unlinked lists...
        - process known inodes and perform inode discovery...
        - agno = 0
        - agno = 1
        - agno = 2
        - agno = 3
        - process newly discovered inodes...
Phase 4 - check for duplicate blocks...
        - setting up duplicate extent list...
        - check for inodes claiming duplicate blocks...
        - agno = 0
        - agno = 1
        - agno = 2
        - agno = 3
Phase 5 - rebuild AG headers and trees...
        - reset superblock...
Phase 6 - check inode connectivity...
        - resetting contents of realtime bitmap and summary inodes
        - traversing filesystem ...
        - traversal finished ...
        - moving disconnected inodes to lost+found ...
Phase 7 - verify and correct link counts...
done
[root@osboxes osboxes]# echo $?
0
[root@osboxes osboxes]# mount /dev/sdb1 /data
[root@osboxes osboxes]# df -h
Filesystem                   Size  Used Avail Use% Mounted on
devtmpfs                     1.9G     0  1.9G   0% /dev
tmpfs                        1.9G     0  1.9G   0% /dev/shm
tmpfs                        1.9G  9.6M  1.9G   1% /run
tmpfs                        1.9G     0  1.9G   0% /sys/fs/cgroup
/dev/sda3                    237G  5.2G  219G   3% /


System backup

5 diff types of backups

1. Syetm backup (enitre image tools usign acronis, veeam, common vault etc)

2. Application backup (3rd party application backup solution)

3. Database backup (Oracle Dataguard, SQL backup etc)

4. File system backup (tar.gzip directories etc)

5. Disk backup or disk cloning (dd command)

dd primary purpose is tp convert and copy files

to backup or clone and entire hard disk to another disk connected to same systeme xecute the dd command as shown 


dd f=<source file name> of=<target file name> options
eg
dd if=/dev/sda pf=/dev/sdb

To backup/copy the disk partition
dd if=/dev/sda1 of=/root/sda1.img

Restoring this image file to other machine after copying the img
dd if=/root/sda1.img of=/dev/sdb3


[root@osboxes osboxes]# dd if=/dev/sda1 of=/data/boot.img
2097152+0 records in
2097152+0 records out
1073741824 bytes (1.1 GB) copied, 36.9215 s, 29.1 MB/s
[root@osboxes osboxes]# cd /data
[root@osboxes data]# ls
boot.img
[root@osboxes data]#

If you are copying from disk to disk then no need to specify /dev/sda1 we can specify /dev/sda


To restore

[root@osboxes data]# dd if=/data/boot.img /dev/sda1


Network File System

NFS - Network File System

1. it is a client server stystem that allow users toa ccess across a newtwork and treat as if they were accessed locally.

2. For eg if you were usign a computer linked to second computer via NFS you could access files on 2nd computer as if they resided in a directory on the first computer. This is accomplished through exporting ( process by which an NFS srver provided remote client with acces to its files and mounting the process by which client map NFS shared file system)



Steps for NFS Server Config

Install Packages
yum install nfs-utils libnsfidmap

Once package are install enable and start NFS services

systemctl enable rpcbind
systemctl enable nfs-server
systemctl start rpcbind
systemctl start nfs-server
systemctl start rpc-statd
systemctl start nfs-idmapd


Create NFS Share directory and assign permissions

mkdir /file
chmod a+rwx /file

Modify /etc/exports file to add new shared file system

/file 192.168.12.7 (rw,sync,no_root_squash) (for only 1 host

/file - NFS Share

192.168.12.7 - IP with we we will share the NFS share, if we put * all server will have access

rw- Read write permission on the share

sync - All changes to file syste, are immeduately flushd to disk, the resepctive write operation are being waited for

no_root_squash - Root on the client machine will have same level of access to the files on the system as root on the server



Once /etc/exports are done export fs with
exportfs -rv


Steps for NFS Client Config

yum install nfs-utils rpcbind

Once package are installed enable and start rpcbind service

service rpcbind start

Make sure firewall and iptables are not running

Show mount from nfs server

showmount -e <server ip>


Create a mount point

mkdir /mnt/app

Mount NFS File system

mount <server ip>:/file /mnt/app

df -haev
unmount <mount point>